{"version":3,"file":"tools.js","sourceRoot":"","sources":["../../../sourceES6/core/Misc/tools.ts"],"names":[],"mappings":"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","sourcesContent":["import { Nullable, float } from \"../types\";\r\nimport { Observable } from \"./observable\";\r\nimport { DomManagement } from \"./domManagement\";\r\nimport { Logger } from \"./logger\";\r\nimport { _TypeStore } from \"./typeStore\";\r\nimport { DeepCopier } from \"./deepCopier\";\r\nimport { PrecisionDate } from \"./precisionDate\";\r\nimport { _DevTools } from \"./devTools\";\r\nimport { WebRequest } from \"./webRequest\";\r\nimport { IFileRequest } from \"./fileRequest\";\r\nimport { EngineStore } from \"../Engines/engineStore\";\r\nimport { FileTools, ReadFileError } from \"./fileTools\";\r\nimport { IOfflineProvider } from \"../Offline/IOfflineProvider\";\r\nimport { PromisePolyfill } from \"./promise\";\r\nimport { TimingTools } from \"./timingTools\";\r\nimport { InstantiationTools } from \"./instantiationTools\";\r\nimport { GUID } from \"./guid\";\r\nimport { IScreenshotSize } from \"./interfaces/screenshotSize\";\r\n\r\ndeclare type Camera = import(\"../Cameras/camera\").Camera;\r\ndeclare type Engine = import(\"../Engines/engine\").Engine;\r\n\r\ninterface IColor4Like {\r\n    r: float;\r\n    g: float;\r\n    b: float;\r\n    a: float;\r\n}\r\n\r\n/**\r\n * Class containing a set of static utilities functions\r\n */\r\nexport class Tools {\r\n    /**\r\n     * Gets or sets the base URL to use to load assets\r\n     */\r\n    public static get BaseUrl() {\r\n        return FileTools.BaseUrl;\r\n    }\r\n\r\n    public static set BaseUrl(value: string) {\r\n        FileTools.BaseUrl = value;\r\n    }\r\n\r\n    /**\r\n     * Enable/Disable Custom HTTP Request Headers globally.\r\n     * default = false\r\n     * @see CustomRequestHeaders\r\n     */\r\n    public static UseCustomRequestHeaders: boolean = false;\r\n\r\n    /**\r\n     * Custom HTTP Request Headers to be sent with XMLHttpRequests\r\n     * i.e. when loading files, where the server/service expects an Authorization header\r\n     */\r\n    public static CustomRequestHeaders = WebRequest.CustomRequestHeaders;\r\n\r\n    /**\r\n     * Gets or sets the retry strategy to apply when an error happens while loading an asset\r\n     */\r\n    public static get DefaultRetryStrategy() {\r\n        return FileTools.DefaultRetryStrategy;\r\n    }\r\n\r\n    public static set DefaultRetryStrategy(strategy: (url: string, request: WebRequest, retryIndex: number) => number) {\r\n        FileTools.DefaultRetryStrategy = strategy;\r\n    }\r\n\r\n    /**\r\n     * Default behaviour for cors in the application.\r\n     * It can be a string if the expected behavior is identical in the entire app.\r\n     * Or a callback to be able to set it per url or on a group of them (in case of Video source for instance)\r\n     */\r\n    public static get CorsBehavior(): string | ((url: string | string[]) => string) {\r\n        return FileTools.CorsBehavior;\r\n    }\r\n\r\n    public static set CorsBehavior(value: string | ((url: string | string[]) => string)) {\r\n        FileTools.CorsBehavior = value;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a global variable indicating if fallback texture must be used when a texture cannot be loaded\r\n     * @ignorenaming\r\n     */\r\n    public static get UseFallbackTexture() {\r\n        return EngineStore.UseFallbackTexture;\r\n    }\r\n\r\n    public static set UseFallbackTexture(value: boolean) {\r\n        EngineStore.UseFallbackTexture = value;\r\n    }\r\n\r\n    /**\r\n     * Use this object to register external classes like custom textures or material\r\n     * to allow the laoders to instantiate them\r\n     */\r\n    public static get RegisteredExternalClasses() {\r\n        return InstantiationTools.RegisteredExternalClasses;\r\n    }\r\n\r\n    public static set RegisteredExternalClasses(classes: { [key: string]: Object }) {\r\n        InstantiationTools.RegisteredExternalClasses = classes;\r\n    }\r\n\r\n    /**\r\n     * Texture content used if a texture cannot loaded\r\n     * @ignorenaming\r\n     */\r\n    public static get fallbackTexture() {\r\n        return EngineStore.FallbackTexture;\r\n    }\r\n\r\n    public static set fallbackTexture(value: string) {\r\n        EngineStore.FallbackTexture = value;\r\n    }\r\n\r\n    /**\r\n     * Read the content of a byte array at a specified coordinates (taking in account wrapping)\r\n     * @param u defines the coordinate on X axis\r\n     * @param v defines the coordinate on Y axis\r\n     * @param width defines the width of the source data\r\n     * @param height defines the height of the source data\r\n     * @param pixels defines the source byte array\r\n     * @param color defines the output color\r\n     */\r\n    public static FetchToRef(u: number, v: number, width: number, height: number, pixels: Uint8Array, color: IColor4Like): void {\r\n        let wrappedU = (Math.abs(u) * width) % width | 0;\r\n        let wrappedV = (Math.abs(v) * height) % height | 0;\r\n\r\n        let position = (wrappedU + wrappedV * width) * 4;\r\n        color.r = pixels[position] / 255;\r\n        color.g = pixels[position + 1] / 255;\r\n        color.b = pixels[position + 2] / 255;\r\n        color.a = pixels[position + 3] / 255;\r\n    }\r\n\r\n    /**\r\n     * Interpolates between a and b via alpha\r\n     * @param a The lower value (returned when alpha = 0)\r\n     * @param b The upper value (returned when alpha = 1)\r\n     * @param alpha The interpolation-factor\r\n     * @return The mixed value\r\n     */\r\n    public static Mix(a: number, b: number, alpha: number): number {\r\n        return a * (1 - alpha) + b * alpha;\r\n    }\r\n\r\n    /**\r\n     * Tries to instantiate a new object from a given class name\r\n     * @param className defines the class name to instantiate\r\n     * @returns the new object or null if the system was not able to do the instantiation\r\n     */\r\n    public static Instantiate(className: string): any {\r\n        return InstantiationTools.Instantiate(className);\r\n    }\r\n\r\n    /**\r\n     * Provides a slice function that will work even on IE\r\n     * @param data defines the array to slice\r\n     * @param start defines the start of the data (optional)\r\n     * @param end defines the end of the data (optional)\r\n     * @returns the new sliced array\r\n     */\r\n    public static Slice<T>(data: T, start?: number, end?: number): T {\r\n        if ((data as any).slice) {\r\n            return (data as any).slice(start, end);\r\n        }\r\n\r\n        return Array.prototype.slice.call(data, start, end);\r\n    }\r\n\r\n    /**\r\n     * Provides a slice function that will work even on IE\r\n     * The difference between this and Slice is that this will force-convert to array\r\n     * @param data defines the array to slice\r\n     * @param start defines the start of the data (optional)\r\n     * @param end defines the end of the data (optional)\r\n     * @returns the new sliced array\r\n     */\r\n    public static SliceToArray<T, P>(data: T, start?: number, end?: number): Array<P> {\r\n        if (Array.isArray(data)) {\r\n            return (data as Array<P>).slice(start, end);\r\n        }\r\n\r\n        return Array.prototype.slice.call(data, start, end);\r\n    }\r\n\r\n    /**\r\n     * Polyfill for setImmediate\r\n     * @param action defines the action to execute after the current execution block\r\n     */\r\n    public static SetImmediate(action: () => void) {\r\n        TimingTools.SetImmediate(action);\r\n    }\r\n\r\n    /**\r\n     * Function indicating if a number is an exponent of 2\r\n     * @param value defines the value to test\r\n     * @returns true if the value is an exponent of 2\r\n     */\r\n    public static IsExponentOfTwo(value: number): boolean {\r\n        var count = 1;\r\n\r\n        do {\r\n            count *= 2;\r\n        } while (count < value);\r\n\r\n        return count === value;\r\n    }\r\n\r\n    private static _tmpFloatArray = new Float32Array(1);\r\n\r\n    /**\r\n     * Returns the nearest 32-bit single precision float representation of a Number\r\n     * @param value A Number.  If the parameter is of a different type, it will get converted\r\n     * to a number or to NaN if it cannot be converted\r\n     * @returns number\r\n     */\r\n    public static FloatRound(value: number): number {\r\n        if (Math.fround) {\r\n            return Math.fround(value);\r\n        }\r\n\r\n        return (Tools._tmpFloatArray[0] = value);\r\n    }\r\n\r\n    /**\r\n     * Extracts the filename from a path\r\n     * @param path defines the path to use\r\n     * @returns the filename\r\n     */\r\n    public static GetFilename(path: string): string {\r\n        var index = path.lastIndexOf(\"/\");\r\n        if (index < 0) {\r\n            return path;\r\n        }\r\n\r\n        return path.substring(index + 1);\r\n    }\r\n\r\n    /**\r\n     * Extracts the \"folder\" part of a path (everything before the filename).\r\n     * @param uri The URI to extract the info from\r\n     * @param returnUnchangedIfNoSlash Do not touch the URI if no slashes are present\r\n     * @returns The \"folder\" part of the path\r\n     */\r\n    public static GetFolderPath(uri: string, returnUnchangedIfNoSlash = false): string {\r\n        var index = uri.lastIndexOf(\"/\");\r\n        if (index < 0) {\r\n            if (returnUnchangedIfNoSlash) {\r\n                return uri;\r\n            }\r\n            return \"\";\r\n        }\r\n\r\n        return uri.substring(0, index + 1);\r\n    }\r\n\r\n    /**\r\n     * Extracts text content from a DOM element hierarchy\r\n     * Back Compat only, please use DomManagement.GetDOMTextContent instead.\r\n     */\r\n    public static GetDOMTextContent = DomManagement.GetDOMTextContent;\r\n\r\n    /**\r\n     * Convert an angle in radians to degrees\r\n     * @param angle defines the angle to convert\r\n     * @returns the angle in degrees\r\n     */\r\n    public static ToDegrees(angle: number): number {\r\n        return (angle * 180) / Math.PI;\r\n    }\r\n\r\n    /**\r\n     * Convert an angle in degrees to radians\r\n     * @param angle defines the angle to convert\r\n     * @returns the angle in radians\r\n     */\r\n    public static ToRadians(angle: number): number {\r\n        return (angle * Math.PI) / 180;\r\n    }\r\n\r\n    /**\r\n     * Returns an array if obj is not an array\r\n     * @param obj defines the object to evaluate as an array\r\n     * @param allowsNullUndefined defines a boolean indicating if obj is allowed to be null or undefined\r\n     * @returns either obj directly if obj is an array or a new array containing obj\r\n     */\r\n    public static MakeArray(obj: any, allowsNullUndefined?: boolean): Nullable<Array<any>> {\r\n        if (allowsNullUndefined !== true && (obj === undefined || obj == null)) {\r\n            return null;\r\n        }\r\n\r\n        return Array.isArray(obj) ? obj : [obj];\r\n    }\r\n\r\n    /**\r\n     * Gets the pointer prefix to use\r\n     * @param engine defines the engine we are finding the prefix for\r\n     * @returns \"pointer\" if touch is enabled. Else returns \"mouse\"\r\n     */\r\n    public static GetPointerPrefix(engine: Engine): string {\r\n        var eventPrefix = \"pointer\";\r\n\r\n        // Check if pointer events are supported\r\n        if (DomManagement.IsWindowObjectExist() && !window.PointerEvent && DomManagement.IsNavigatorAvailable() && !navigator.pointerEnabled) {\r\n            eventPrefix = \"mouse\";\r\n        }\r\n\r\n        // Special Fallback MacOS Safari...\r\n        if (\r\n            engine._badDesktopOS &&\r\n            !engine._badOS &&\r\n            // And not ipad pros who claim to be macs...\r\n            !(document && \"ontouchend\" in document)\r\n        ) {\r\n            eventPrefix = \"mouse\";\r\n        }\r\n\r\n        return eventPrefix;\r\n    }\r\n\r\n    /**\r\n     * Sets the cors behavior on a dom element. This will add the required Tools.CorsBehavior to the element.\r\n     * @param url define the url we are trying\r\n     * @param element define the dom element where to configure the cors policy\r\n     */\r\n    public static SetCorsBehavior(url: string | string[], element: { crossOrigin: string | null }): void {\r\n        FileTools.SetCorsBehavior(url, element);\r\n    }\r\n\r\n    // External files\r\n\r\n    /**\r\n     * Removes unwanted characters from an url\r\n     * @param url defines the url to clean\r\n     * @returns the cleaned url\r\n     */\r\n    public static CleanUrl(url: string): string {\r\n        url = url.replace(/#/gm, \"%23\");\r\n        return url;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a function used to pre-process url before using them to load assets\r\n     */\r\n    public static get PreprocessUrl() {\r\n        return FileTools.PreprocessUrl;\r\n    }\r\n\r\n    public static set PreprocessUrl(processor: (url: string) => string) {\r\n        FileTools.PreprocessUrl = processor;\r\n    }\r\n\r\n    /**\r\n     * Loads an image as an HTMLImageElement.\r\n     * @param input url string, ArrayBuffer, or Blob to load\r\n     * @param onLoad callback called when the image successfully loads\r\n     * @param onError callback called when the image fails to load\r\n     * @param offlineProvider offline provider for caching\r\n     * @param mimeType optional mime type\r\n     * @returns the HTMLImageElement of the loaded image\r\n     */\r\n    public static LoadImage(input: string | ArrayBuffer | Blob, onLoad: (img: HTMLImageElement | ImageBitmap) => void, onError: (message?: string, exception?: any) => void, offlineProvider: Nullable<IOfflineProvider>, mimeType?: string): Nullable<HTMLImageElement> {\r\n        return FileTools.LoadImage(input, onLoad, onError, offlineProvider, mimeType);\r\n    }\r\n\r\n    /**\r\n     * Loads a file from a url\r\n     * @param url url string, ArrayBuffer, or Blob to load\r\n     * @param onSuccess callback called when the file successfully loads\r\n     * @param onProgress callback called while file is loading (if the server supports this mode)\r\n     * @param offlineProvider defines the offline provider for caching\r\n     * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n     * @param onError callback called when the file fails to load\r\n     * @returns a file request object\r\n     */\r\n    public static LoadFile(url: string, onSuccess: (data: string | ArrayBuffer, responseURL?: string) => void, onProgress?: (data: any) => void, offlineProvider?: IOfflineProvider, useArrayBuffer?: boolean, onError?: (request?: WebRequest, exception?: any) => void): IFileRequest {\r\n        return FileTools.LoadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError);\r\n    }\r\n\r\n    /**\r\n     * Loads a file from a url\r\n     * @param url the file url to load\r\n     * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n     * @returns a promise containing an ArrayBuffer corresponding to the loaded file\r\n     */\r\n    public static LoadFileAsync(url: string, useArrayBuffer: boolean = true): Promise<ArrayBuffer | string> {\r\n        return new Promise((resolve, reject) => {\r\n            FileTools.LoadFile(\r\n                url,\r\n                (data) => {\r\n                    resolve(data);\r\n                },\r\n                undefined,\r\n                undefined,\r\n                useArrayBuffer,\r\n                (request, exception) => {\r\n                    reject(exception);\r\n                }\r\n            );\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Load a script (identified by an url). When the url returns, the\r\n     * content of this file is added into a new script element, attached to the DOM (body element)\r\n     * @param scriptUrl defines the url of the script to laod\r\n     * @param onSuccess defines the callback called when the script is loaded\r\n     * @param onError defines the callback to call if an error occurs\r\n     * @param scriptId defines the id of the script element\r\n     */\r\n    public static LoadScript(scriptUrl: string, onSuccess: () => void, onError?: (message?: string, exception?: any) => void, scriptId?: string) {\r\n        if (!DomManagement.IsWindowObjectExist()) {\r\n            return;\r\n        }\r\n        var head = document.getElementsByTagName(\"head\")[0];\r\n        var script = document.createElement(\"script\");\r\n        script.setAttribute(\"type\", \"text/javascript\");\r\n        script.setAttribute(\"src\", scriptUrl);\r\n        if (scriptId) {\r\n            script.id = scriptId;\r\n        }\r\n\r\n        script.onload = () => {\r\n            if (onSuccess) {\r\n                onSuccess();\r\n            }\r\n        };\r\n\r\n        script.onerror = (e) => {\r\n            if (onError) {\r\n                onError(`Unable to load script '${scriptUrl}'`, e);\r\n            }\r\n        };\r\n\r\n        head.appendChild(script);\r\n    }\r\n\r\n    /**\r\n     * Load an asynchronous script (identified by an url). When the url returns, the\r\n     * content of this file is added into a new script element, attached to the DOM (body element)\r\n     * @param scriptUrl defines the url of the script to laod\r\n     * @param scriptId defines the id of the script element\r\n     * @returns a promise request object\r\n     */\r\n    public static LoadScriptAsync(scriptUrl: string, scriptId?: string): Promise<void> {\r\n        return new Promise((resolve, reject) => {\r\n            this.LoadScript(\r\n                scriptUrl,\r\n                () => {\r\n                    resolve();\r\n                },\r\n                (message, exception) => {\r\n                    reject(exception);\r\n                }\r\n            );\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Loads a file from a blob\r\n     * @param fileToLoad defines the blob to use\r\n     * @param callback defines the callback to call when data is loaded\r\n     * @param progressCallback defines the callback to call during loading process\r\n     * @returns a file request object\r\n     */\r\n    public static ReadFileAsDataURL(fileToLoad: Blob, callback: (data: any) => void, progressCallback: (ev: ProgressEvent) => any): IFileRequest {\r\n        let reader = new FileReader();\r\n\r\n        let request: IFileRequest = {\r\n            onCompleteObservable: new Observable<IFileRequest>(),\r\n            abort: () => reader.abort(),\r\n        };\r\n\r\n        reader.onloadend = (e) => {\r\n            request.onCompleteObservable.notifyObservers(request);\r\n        };\r\n\r\n        reader.onload = (e) => {\r\n            //target doesn't have result from ts 1.3\r\n            callback((<any>e.target)[\"result\"]);\r\n        };\r\n\r\n        reader.onprogress = progressCallback;\r\n\r\n        reader.readAsDataURL(fileToLoad);\r\n\r\n        return request;\r\n    }\r\n\r\n    /**\r\n     * Reads a file from a File object\r\n     * @param file defines the file to load\r\n     * @param onSuccess defines the callback to call when data is loaded\r\n     * @param onProgress defines the callback to call during loading process\r\n     * @param useArrayBuffer defines a boolean indicating that data must be returned as an ArrayBuffer\r\n     * @param onError defines the callback to call when an error occurs\r\n     * @returns a file request object\r\n     */\r\n    public static ReadFile(file: File, onSuccess: (data: any) => void, onProgress?: (ev: ProgressEvent) => any, useArrayBuffer?: boolean, onError?: (error: ReadFileError) => void): IFileRequest {\r\n        return FileTools.ReadFile(file, onSuccess, onProgress, useArrayBuffer, onError);\r\n    }\r\n\r\n    /**\r\n     * Creates a data url from a given string content\r\n     * @param content defines the content to convert\r\n     * @returns the new data url link\r\n     */\r\n    public static FileAsURL(content: string): string {\r\n        var fileBlob = new Blob([content]);\r\n        var url = window.URL || window.webkitURL;\r\n        var link: string = url.createObjectURL(fileBlob);\r\n        return link;\r\n    }\r\n\r\n    /**\r\n     * Format the given number to a specific decimal format\r\n     * @param value defines the number to format\r\n     * @param decimals defines the number of decimals to use\r\n     * @returns the formatted string\r\n     */\r\n    public static Format(value: number, decimals: number = 2): string {\r\n        return value.toFixed(decimals);\r\n    }\r\n\r\n    /**\r\n     * Tries to copy an object by duplicating every property\r\n     * @param source defines the source object\r\n     * @param destination defines the target object\r\n     * @param doNotCopyList defines a list of properties to avoid\r\n     * @param mustCopyList defines a list of properties to copy (even if they start with _)\r\n     */\r\n    public static DeepCopy(source: any, destination: any, doNotCopyList?: string[], mustCopyList?: string[]): void {\r\n        DeepCopier.DeepCopy(source, destination, doNotCopyList, mustCopyList);\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if the given object has no own property\r\n     * @param obj defines the object to test\r\n     * @returns true if object has no own property\r\n     */\r\n    public static IsEmpty(obj: any): boolean {\r\n        for (var i in obj) {\r\n            if (obj.hasOwnProperty(i)) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Function used to register events at window level\r\n     * @param windowElement defines the Window object to use\r\n     * @param events defines the events to register\r\n     */\r\n    public static RegisterTopRootEvents(windowElement: Window, events: { name: string; handler: Nullable<(e: FocusEvent) => any> }[]): void {\r\n        for (var index = 0; index < events.length; index++) {\r\n            var event = events[index];\r\n            windowElement.addEventListener(event.name, <any>event.handler, false);\r\n\r\n            try {\r\n                if (window.parent) {\r\n                    window.parent.addEventListener(event.name, <any>event.handler, false);\r\n                }\r\n            } catch (e) {\r\n                // Silently fails...\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Function used to unregister events from window level\r\n     * @param windowElement defines the Window object to use\r\n     * @param events defines the events to unregister\r\n     */\r\n    public static UnregisterTopRootEvents(windowElement: Window, events: { name: string; handler: Nullable<(e: FocusEvent) => any> }[]): void {\r\n        for (var index = 0; index < events.length; index++) {\r\n            var event = events[index];\r\n            windowElement.removeEventListener(event.name, <any>event.handler);\r\n\r\n            try {\r\n                if (windowElement.parent) {\r\n                    windowElement.parent.removeEventListener(event.name, <any>event.handler);\r\n                }\r\n            } catch (e) {\r\n                // Silently fails...\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @ignore\r\n     */\r\n    public static _ScreenshotCanvas: HTMLCanvasElement;\r\n\r\n    /**\r\n     * Dumps the current bound framebuffer\r\n     * @param width defines the rendering width\r\n     * @param height defines the rendering height\r\n     * @param engine defines the hosting engine\r\n     * @param successCallback defines the callback triggered once the data are available\r\n     * @param mimeType defines the mime type of the result\r\n     * @param fileName defines the filename to download. If present, the result will automatically be downloaded\r\n     */\r\n    public static DumpFramebuffer(width: number, height: number, engine: Engine, successCallback?: (data: string) => void, mimeType: string = \"image/png\", fileName?: string): void {\r\n        // Read the contents of the framebuffer\r\n        var numberOfChannelsByLine = width * 4;\r\n        var halfHeight = height / 2;\r\n\r\n        //Reading datas from WebGL\r\n        var data = engine.readPixels(0, 0, width, height);\r\n\r\n        //To flip image on Y axis.\r\n        for (var i = 0; i < halfHeight; i++) {\r\n            for (var j = 0; j < numberOfChannelsByLine; j++) {\r\n                var currentCell = j + i * numberOfChannelsByLine;\r\n                var targetLine = height - i - 1;\r\n                var targetCell = j + targetLine * numberOfChannelsByLine;\r\n\r\n                var temp = data[currentCell];\r\n                data[currentCell] = data[targetCell];\r\n                data[targetCell] = temp;\r\n            }\r\n        }\r\n\r\n        // Create a 2D canvas to store the result\r\n        if (!Tools._ScreenshotCanvas) {\r\n            Tools._ScreenshotCanvas = document.createElement(\"canvas\");\r\n        }\r\n        Tools._ScreenshotCanvas.width = width;\r\n        Tools._ScreenshotCanvas.height = height;\r\n        var context = Tools._ScreenshotCanvas.getContext(\"2d\");\r\n\r\n        if (context) {\r\n            // Copy the pixels to a 2D canvas\r\n            var imageData = context.createImageData(width, height);\r\n            var castData = <any>imageData.data;\r\n            castData.set(data);\r\n            context.putImageData(imageData, 0, 0);\r\n\r\n            Tools.EncodeScreenshotCanvasData(successCallback, mimeType, fileName);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Converts the canvas data to blob.\r\n     * This acts as a polyfill for browsers not supporting the to blob function.\r\n     * @param canvas Defines the canvas to extract the data from\r\n     * @param successCallback Defines the callback triggered once the data are available\r\n     * @param mimeType Defines the mime type of the result\r\n     */\r\n    static ToBlob(canvas: HTMLCanvasElement, successCallback: (blob: Nullable<Blob>) => void, mimeType: string = \"image/png\"): void {\r\n        // We need HTMLCanvasElement.toBlob for HD screenshots\r\n        if (!canvas.toBlob) {\r\n            //  low performance polyfill based on toDataURL (https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob)\r\n            canvas.toBlob = function (callback, type, quality) {\r\n                setTimeout(() => {\r\n                    var binStr = atob(this.toDataURL(type, quality).split(\",\")[1]),\r\n                        len = binStr.length,\r\n                        arr = new Uint8Array(len);\r\n\r\n                    for (var i = 0; i < len; i++) {\r\n                        arr[i] = binStr.charCodeAt(i);\r\n                    }\r\n                    callback(new Blob([arr]));\r\n                });\r\n            };\r\n        }\r\n        canvas.toBlob(function (blob) {\r\n            successCallback(blob);\r\n        }, mimeType);\r\n    }\r\n\r\n    /**\r\n     * Encodes the canvas data to base 64 or automatically download the result if filename is defined\r\n     * @param successCallback defines the callback triggered once the data are available\r\n     * @param mimeType defines the mime type of the result\r\n     * @param fileName defines he filename to download. If present, the result will automatically be downloaded\r\n     */\r\n    static EncodeScreenshotCanvasData(successCallback?: (data: string) => void, mimeType: string = \"image/png\", fileName?: string): void {\r\n        if (successCallback) {\r\n            var base64Image = Tools._ScreenshotCanvas.toDataURL(mimeType);\r\n            successCallback(base64Image);\r\n        } else {\r\n            this.ToBlob(\r\n                Tools._ScreenshotCanvas,\r\n                function (blob) {\r\n                    //Creating a link if the browser have the download attribute on the a tag, to automatically start download generated image.\r\n                    if (\"download\" in document.createElement(\"a\")) {\r\n                        if (!fileName) {\r\n                            var date = new Date();\r\n                            var stringDate = (date.getFullYear() + \"-\" + (date.getMonth() + 1)).slice(2) + \"-\" + date.getDate() + \"_\" + date.getHours() + \"-\" + (\"0\" + date.getMinutes()).slice(-2);\r\n                            fileName = \"screenshot_\" + stringDate + \".png\";\r\n                        }\r\n                        Tools.Download(blob!, fileName);\r\n                    } else {\r\n                        var url = URL.createObjectURL(blob);\r\n\r\n                        var newWindow = window.open(\"\");\r\n                        if (!newWindow) {\r\n                            return;\r\n                        }\r\n                        var img = newWindow.document.createElement(\"img\");\r\n                        img.onload = function () {\r\n                            // no longer need to read the blob so it's revoked\r\n                            URL.revokeObjectURL(url);\r\n                        };\r\n                        img.src = url;\r\n                        newWindow.document.body.appendChild(img);\r\n                    }\r\n                },\r\n                mimeType\r\n            );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Downloads a blob in the browser\r\n     * @param blob defines the blob to download\r\n     * @param fileName defines the name of the downloaded file\r\n     */\r\n    public static Download(blob: Blob, fileName: string): void {\r\n        if (navigator && navigator.msSaveBlob) {\r\n            navigator.msSaveBlob(blob, fileName);\r\n            return;\r\n        }\r\n\r\n        var url = window.URL.createObjectURL(blob);\r\n        var a = document.createElement(\"a\");\r\n        document.body.appendChild(a);\r\n        a.style.display = \"none\";\r\n        a.href = url;\r\n        a.download = fileName;\r\n        a.addEventListener(\"click\", () => {\r\n            if (a.parentElement) {\r\n                a.parentElement.removeChild(a);\r\n            }\r\n        });\r\n        a.click();\r\n        window.URL.revokeObjectURL(url);\r\n    }\r\n\r\n    /**\r\n     * Will return the right value of the noPreventDefault variable\r\n     * Needed to keep backwards compatibility to the old API.\r\n     *\r\n     * @param args arguments passed to the attachControl function\r\n     * @returns the correct value for noPreventDefault\r\n     */\r\n    public static BackCompatCameraNoPreventDefault(args: IArguments): boolean {\r\n        // is it used correctly?\r\n        if (typeof args[0] === \"boolean\") {\r\n            return args[0];\r\n        } else if (typeof args[1] === \"boolean\") {\r\n            return args[1];\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Captures a screenshot of the current rendering\r\n     * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\r\n     * @param engine defines the rendering engine\r\n     * @param camera defines the source camera\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param successCallback defines the callback receives a single parameter which contains the\r\n     * screenshot as a string of base64-encoded characters. This string can be assigned to the\r\n     * src parameter of an <img> to display it\r\n     * @param mimeType defines the MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     */\r\n    public static CreateScreenshot(engine: Engine, camera: Camera, size: IScreenshotSize | number, successCallback?: (data: string) => void, mimeType: string = \"image/png\"): void {\r\n        throw _DevTools.WarnImport(\"ScreenshotTools\");\r\n    }\r\n\r\n    /**\r\n     * Captures a screenshot of the current rendering\r\n     * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\r\n     * @param engine defines the rendering engine\r\n     * @param camera defines the source camera\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param mimeType defines the MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @returns screenshot as a string of base64-encoded characters. This string can be assigned\r\n     * to the src parameter of an <img> to display it\r\n     */\r\n    public static CreateScreenshotAsync(engine: Engine, camera: Camera, size: IScreenshotSize | number, mimeType: string = \"image/png\"): Promise<string> {\r\n        throw _DevTools.WarnImport(\"ScreenshotTools\");\r\n    }\r\n\r\n    /**\r\n     * Generates an image screenshot from the specified camera.\r\n     * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\r\n     * @param engine The engine to use for rendering\r\n     * @param camera The camera to use for rendering\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param successCallback The callback receives a single parameter which contains the\r\n     * screenshot as a string of base64-encoded characters. This string can be assigned to the\r\n     * src parameter of an <img> to display it\r\n     * @param mimeType The MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @param samples Texture samples (default: 1)\r\n     * @param antialiasing Whether antialiasing should be turned on or not (default: false)\r\n     * @param fileName A name for for the downloaded file.\r\n     */\r\n    public static CreateScreenshotUsingRenderTarget(engine: Engine, camera: Camera, size: IScreenshotSize | number, successCallback?: (data: string) => void, mimeType: string = \"image/png\", samples: number = 1, antialiasing: boolean = false, fileName?: string): void {\r\n        throw _DevTools.WarnImport(\"ScreenshotTools\");\r\n    }\r\n\r\n    /**\r\n     * Generates an image screenshot from the specified camera.\r\n     * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\r\n     * @param engine The engine to use for rendering\r\n     * @param camera The camera to use for rendering\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param mimeType The MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @param samples Texture samples (default: 1)\r\n     * @param antialiasing Whether antialiasing should be turned on or not (default: false)\r\n     * @param fileName A name for for the downloaded file.\r\n     * @returns screenshot as a string of base64-encoded characters. This string can be assigned\r\n     * to the src parameter of an <img> to display it\r\n     */\r\n    public static CreateScreenshotUsingRenderTargetAsync(engine: Engine, camera: Camera, size: IScreenshotSize | number, mimeType: string = \"image/png\", samples: number = 1, antialiasing: boolean = false, fileName?: string): Promise<string> {\r\n        throw _DevTools.WarnImport(\"ScreenshotTools\");\r\n    }\r\n\r\n    /**\r\n     * Implementation from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/2117523#answer-2117523\r\n     * Be aware Math.random() could cause collisions, but:\r\n     * \"All but 6 of the 128 bits of the ID are randomly generated, which means that for any two ids, there's a 1 in 2^^122 (or 5.3x10^^36) chance they'll collide\"\r\n     * @returns a pseudo random id\r\n     */\r\n    public static RandomId(): string {\r\n        return GUID.RandomId();\r\n    }\r\n\r\n    /**\r\n     * Test if the given uri is a base64 string\r\n     * @param uri The uri to test\r\n     * @return True if the uri is a base64 string or false otherwise\r\n     */\r\n    public static IsBase64(uri: string): boolean {\r\n        return uri.length < 5 ? false : uri.substr(0, 5) === \"data:\";\r\n    }\r\n\r\n    /**\r\n     * Decode the given base64 uri.\r\n     * @param uri The uri to decode\r\n     * @return The decoded base64 data.\r\n     */\r\n    public static DecodeBase64(uri: string): ArrayBuffer {\r\n        const decodedString = atob(uri.split(\",\")[1]);\r\n        const bufferLength = decodedString.length;\r\n        const bufferView = new Uint8Array(new ArrayBuffer(bufferLength));\r\n\r\n        for (let i = 0; i < bufferLength; i++) {\r\n            bufferView[i] = decodedString.charCodeAt(i);\r\n        }\r\n\r\n        return bufferView.buffer;\r\n    }\r\n\r\n    /**\r\n     * Gets the absolute url.\r\n     * @param url the input url\r\n     * @return the absolute url\r\n     */\r\n    public static GetAbsoluteUrl(url: string): string {\r\n        const a = document.createElement(\"a\");\r\n        a.href = url;\r\n        return a.href;\r\n    }\r\n\r\n    // Logs\r\n    /**\r\n     * No log\r\n     */\r\n    public static readonly NoneLogLevel = Logger.NoneLogLevel;\r\n    /**\r\n     * Only message logs\r\n     */\r\n    public static readonly MessageLogLevel = Logger.MessageLogLevel;\r\n    /**\r\n     * Only warning logs\r\n     */\r\n    public static readonly WarningLogLevel = Logger.WarningLogLevel;\r\n    /**\r\n     * Only error logs\r\n     */\r\n    public static readonly ErrorLogLevel = Logger.ErrorLogLevel;\r\n    /**\r\n     * All logs\r\n     */\r\n    public static readonly AllLogLevel = Logger.AllLogLevel;\r\n\r\n    /**\r\n     * Gets a value indicating the number of loading errors\r\n     * @ignorenaming\r\n     */\r\n    public static get errorsCount(): number {\r\n        return Logger.errorsCount;\r\n    }\r\n\r\n    /**\r\n     * Callback called when a new log is added\r\n     */\r\n    public static OnNewCacheEntry: (entry: string) => void;\r\n\r\n    /**\r\n     * Log a message to the console\r\n     * @param message defines the message to log\r\n     */\r\n    public static Log(message: string): void {\r\n        Logger.Log(message);\r\n    }\r\n\r\n    /**\r\n     * Write a warning message to the console\r\n     * @param message defines the message to log\r\n     */\r\n    public static Warn(message: string): void {\r\n        Logger.Warn(message);\r\n    }\r\n\r\n    /**\r\n     * Write an error message to the console\r\n     * @param message defines the message to log\r\n     */\r\n    public static Error(message: string): void {\r\n        Logger.Error(message);\r\n    }\r\n\r\n    /**\r\n     * Gets current log cache (list of logs)\r\n     */\r\n    public static get LogCache(): string {\r\n        return Logger.LogCache;\r\n    }\r\n\r\n    /**\r\n     * Clears the log cache\r\n     */\r\n    public static ClearLogCache(): void {\r\n        Logger.ClearLogCache();\r\n    }\r\n\r\n    /**\r\n     * Sets the current log level (MessageLogLevel / WarningLogLevel / ErrorLogLevel)\r\n     */\r\n    public static set LogLevels(level: number) {\r\n        Logger.LogLevels = level;\r\n    }\r\n\r\n    /**\r\n     * Checks if the window object exists\r\n     * Back Compat only, please use DomManagement.IsWindowObjectExist instead.\r\n     */\r\n    public static IsWindowObjectExist = DomManagement.IsWindowObjectExist;\r\n\r\n    // Performances\r\n\r\n    /**\r\n     * No performance log\r\n     */\r\n    public static readonly PerformanceNoneLogLevel = 0;\r\n    /**\r\n     * Use user marks to log performance\r\n     */\r\n    public static readonly PerformanceUserMarkLogLevel = 1;\r\n    /**\r\n     * Log performance to the console\r\n     */\r\n    public static readonly PerformanceConsoleLogLevel = 2;\r\n\r\n    private static _performance: Performance;\r\n\r\n    /**\r\n     * Sets the current performance log level\r\n     */\r\n    public static set PerformanceLogLevel(level: number) {\r\n        if ((level & Tools.PerformanceUserMarkLogLevel) === Tools.PerformanceUserMarkLogLevel) {\r\n            Tools.StartPerformanceCounter = Tools._StartUserMark;\r\n            Tools.EndPerformanceCounter = Tools._EndUserMark;\r\n            return;\r\n        }\r\n\r\n        if ((level & Tools.PerformanceConsoleLogLevel) === Tools.PerformanceConsoleLogLevel) {\r\n            Tools.StartPerformanceCounter = Tools._StartPerformanceConsole;\r\n            Tools.EndPerformanceCounter = Tools._EndPerformanceConsole;\r\n            return;\r\n        }\r\n\r\n        Tools.StartPerformanceCounter = Tools._StartPerformanceCounterDisabled;\r\n        Tools.EndPerformanceCounter = Tools._EndPerformanceCounterDisabled;\r\n    }\r\n\r\n    private static _StartPerformanceCounterDisabled(counterName: string, condition?: boolean): void {}\r\n\r\n    private static _EndPerformanceCounterDisabled(counterName: string, condition?: boolean): void {}\r\n\r\n    private static _StartUserMark(counterName: string, condition = true): void {\r\n        if (!Tools._performance) {\r\n            if (!DomManagement.IsWindowObjectExist()) {\r\n                return;\r\n            }\r\n            Tools._performance = window.performance;\r\n        }\r\n\r\n        if (!condition || !Tools._performance.mark) {\r\n            return;\r\n        }\r\n        Tools._performance.mark(counterName + \"-Begin\");\r\n    }\r\n\r\n    private static _EndUserMark(counterName: string, condition = true): void {\r\n        if (!condition || !Tools._performance.mark) {\r\n            return;\r\n        }\r\n        Tools._performance.mark(counterName + \"-End\");\r\n        Tools._performance.measure(counterName, counterName + \"-Begin\", counterName + \"-End\");\r\n    }\r\n\r\n    private static _StartPerformanceConsole(counterName: string, condition = true): void {\r\n        if (!condition) {\r\n            return;\r\n        }\r\n\r\n        Tools._StartUserMark(counterName, condition);\r\n\r\n        if (console.time) {\r\n            console.time(counterName);\r\n        }\r\n    }\r\n\r\n    private static _EndPerformanceConsole(counterName: string, condition = true): void {\r\n        if (!condition) {\r\n            return;\r\n        }\r\n\r\n        Tools._EndUserMark(counterName, condition);\r\n\r\n        console.timeEnd(counterName);\r\n    }\r\n\r\n    /**\r\n     * Starts a performance counter\r\n     */\r\n    public static StartPerformanceCounter: (counterName: string, condition?: boolean) => void = Tools._StartPerformanceCounterDisabled;\r\n\r\n    /**\r\n     * Ends a specific performance coutner\r\n     */\r\n    public static EndPerformanceCounter: (counterName: string, condition?: boolean) => void = Tools._EndPerformanceCounterDisabled;\r\n\r\n    /**\r\n     * Gets either window.performance.now() if supported or Date.now() else\r\n     */\r\n    public static get Now(): number {\r\n        return PrecisionDate.Now;\r\n    }\r\n\r\n    /**\r\n     * This method will return the name of the class used to create the instance of the given object.\r\n     * It will works only on Javascript basic data types (number, string, ...) and instance of class declared with the @className decorator.\r\n     * @param object the object to get the class name from\r\n     * @param isType defines if the object is actually a type\r\n     * @returns the name of the class, will be \"object\" for a custom data type not using the @className decorator\r\n     */\r\n    public static GetClassName(object: any, isType: boolean = false): string {\r\n        let name = null;\r\n\r\n        if (!isType && object.getClassName) {\r\n            name = object.getClassName();\r\n        } else {\r\n            if (object instanceof Object) {\r\n                let classObj = isType ? object : Object.getPrototypeOf(object);\r\n                name = classObj.constructor[\"__bjsclassName__\"];\r\n            }\r\n            if (!name) {\r\n                name = typeof object;\r\n            }\r\n        }\r\n        return name;\r\n    }\r\n\r\n    /**\r\n     * Gets the first element of an array satisfying a given predicate\r\n     * @param array defines the array to browse\r\n     * @param predicate defines the predicate to use\r\n     * @returns null if not found or the element\r\n     */\r\n    public static First<T>(array: Array<T>, predicate: (item: T) => boolean): Nullable<T> {\r\n        for (let el of array) {\r\n            if (predicate(el)) {\r\n                return el;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * This method will return the name of the full name of the class, including its owning module (if any).\r\n     * It will works only on Javascript basic data types (number, string, ...) and instance of class declared with the @className decorator or implementing a method getClassName():string (in which case the module won't be specified).\r\n     * @param object the object to get the class name from\r\n     * @param isType defines if the object is actually a type\r\n     * @return a string that can have two forms: \"moduleName.className\" if module was specified when the class' Name was registered or \"className\" if there was not module specified.\r\n     * @ignorenaming\r\n     */\r\n    public static getFullClassName(object: any, isType: boolean = false): Nullable<string> {\r\n        let className = null;\r\n        let moduleName = null;\r\n\r\n        if (!isType && object.getClassName) {\r\n            className = object.getClassName();\r\n        } else {\r\n            if (object instanceof Object) {\r\n                let classObj = isType ? object : Object.getPrototypeOf(object);\r\n                className = classObj.constructor[\"__bjsclassName__\"];\r\n                moduleName = classObj.constructor[\"__bjsmoduleName__\"];\r\n            }\r\n            if (!className) {\r\n                className = typeof object;\r\n            }\r\n        }\r\n\r\n        if (!className) {\r\n            return null;\r\n        }\r\n\r\n        return (moduleName != null ? moduleName + \".\" : \"\") + className;\r\n    }\r\n\r\n    /**\r\n     * Returns a promise that resolves after the given amount of time.\r\n     * @param delay Number of milliseconds to delay\r\n     * @returns Promise that resolves after the given amount of time\r\n     */\r\n    public static DelayAsync(delay: number): Promise<void> {\r\n        return new Promise((resolve) => {\r\n            setTimeout(() => {\r\n                resolve();\r\n            }, delay);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Utility function to detect if the current user agent is Safari\r\n     * @returns whether or not the current user agent is safari\r\n     */\r\n    public static IsSafari(): boolean {\r\n        return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\r\n    }\r\n}\r\n\r\n/**\r\n * Use this className as a decorator on a given class definition to add it a name and optionally its module.\r\n * You can then use the Tools.getClassName(obj) on an instance to retrieve its class name.\r\n * This method is the only way to get it done in all cases, even if the .js file declaring the class is minified\r\n * @param name The name of the class, case should be preserved\r\n * @param module The name of the Module hosting the class, optional, but strongly recommended to specify if possible. Case should be preserved.\r\n */\r\nexport function className(name: string, module?: string): (target: Object) => void {\r\n    return (target: Object) => {\r\n        (<any>target)[\"__bjsclassName__\"] = name;\r\n        (<any>target)[\"__bjsmoduleName__\"] = module != null ? module : null;\r\n    };\r\n}\r\n\r\n/**\r\n * An implementation of a loop for asynchronous functions.\r\n */\r\nexport class AsyncLoop {\r\n    /**\r\n     * Defines the current index of the loop.\r\n     */\r\n    public index: number;\r\n    private _done: boolean;\r\n    private _fn: (asyncLoop: AsyncLoop) => void;\r\n    private _successCallback: () => void;\r\n\r\n    /**\r\n     * Constructor.\r\n     * @param iterations the number of iterations.\r\n     * @param func the function to run each iteration\r\n     * @param successCallback the callback that will be called upon succesful execution\r\n     * @param offset starting offset.\r\n     */\r\n    constructor(\r\n        /**\r\n         * Defines the number of iterations for the loop\r\n         */\r\n        public iterations: number,\r\n        func: (asyncLoop: AsyncLoop) => void,\r\n        successCallback: () => void,\r\n        offset: number = 0\r\n    ) {\r\n        this.index = offset - 1;\r\n        this._done = false;\r\n        this._fn = func;\r\n        this._successCallback = successCallback;\r\n    }\r\n\r\n    /**\r\n     * Execute the next iteration. Must be called after the last iteration was finished.\r\n     */\r\n    public executeNext(): void {\r\n        if (!this._done) {\r\n            if (this.index + 1 < this.iterations) {\r\n                ++this.index;\r\n                this._fn(this);\r\n            } else {\r\n                this.breakLoop();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Break the loop and run the success callback.\r\n     */\r\n    public breakLoop(): void {\r\n        this._done = true;\r\n        this._successCallback();\r\n    }\r\n\r\n    /**\r\n     * Create and run an async loop.\r\n     * @param iterations the number of iterations.\r\n     * @param fn the function to run each iteration\r\n     * @param successCallback the callback that will be called upon succesful execution\r\n     * @param offset starting offset.\r\n     * @returns the created async loop object\r\n     */\r\n    public static Run(iterations: number, fn: (asyncLoop: AsyncLoop) => void, successCallback: () => void, offset: number = 0): AsyncLoop {\r\n        var loop = new AsyncLoop(iterations, fn, successCallback, offset);\r\n\r\n        loop.executeNext();\r\n\r\n        return loop;\r\n    }\r\n\r\n    /**\r\n     * A for-loop that will run a given number of iterations synchronous and the rest async.\r\n     * @param iterations total number of iterations\r\n     * @param syncedIterations number of synchronous iterations in each async iteration.\r\n     * @param fn the function to call each iteration.\r\n     * @param callback a success call back that will be called when iterating stops.\r\n     * @param breakFunction a break condition (optional)\r\n     * @param timeout timeout settings for the setTimeout function. default - 0.\r\n     * @returns the created async loop object\r\n     */\r\n    public static SyncAsyncForLoop(iterations: number, syncedIterations: number, fn: (iteration: number) => void, callback: () => void, breakFunction?: () => boolean, timeout: number = 0): AsyncLoop {\r\n        return AsyncLoop.Run(\r\n            Math.ceil(iterations / syncedIterations),\r\n            (loop: AsyncLoop) => {\r\n                if (breakFunction && breakFunction()) {\r\n                    loop.breakLoop();\r\n                } else {\r\n                    setTimeout(() => {\r\n                        for (var i = 0; i < syncedIterations; ++i) {\r\n                            var iteration = loop.index * syncedIterations + i;\r\n                            if (iteration >= iterations) {\r\n                                break;\r\n                            }\r\n                            fn(iteration);\r\n                            if (breakFunction && breakFunction()) {\r\n                                loop.breakLoop();\r\n                                break;\r\n                            }\r\n                        }\r\n                        loop.executeNext();\r\n                    }, timeout);\r\n                }\r\n            },\r\n            callback\r\n        );\r\n    }\r\n}\r\n\r\n// Will only be define if Tools is imported freeing up some space when only engine is required\r\nEngineStore.FallbackTexture =\r\n    \"data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z\";\r\n\r\n// Register promise fallback for IE\r\nPromisePolyfill.Apply();\r\n"]}